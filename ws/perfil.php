<?php/** * Created by JetBrains PhpStorm. * User: Irian * Date: 11/02/17 * Time: 14:20 * To change this template use File | Settings | File Templates. */include_once 'lib/cors.php';include_once 'lib/model/Perfil.php';try {    $perfil = new Perfil();    $postdata = file_get_contents("php://input");    $request = json_decode($postdata);    /*$request = (object)array(        'email' => 'irianbsb@hotmail.com',        'nome' => 'irian',        'sobrenome' => 'villalba',        'situacao' => 'config',        'senha' => '123456',        'dt_nascimento' => '2000-01-01',        'sexo' => 'f',        'rede_social' => 'facebook',        'id_perfil' => 8    );*/    $data_cadastro = date("Y-m-d H:i:s");    switch ($request->situacao) {        case 'cadastro':                if (isset($request->usuario->email)) {                    $reg = $perfil->getRow('perfil', "email = '{$request->usuario->email}'", array('email'));                    if(isset($reg['email'])) {                        echo 'email cadastrado';                        exit;                    }                    $cmp = array('email', 'nome', 'sobrenome', 'senha', 'dt_cadastro');                    $vlr = array($request->usuario->email, $request->usuario->first_name, $request->usuario->last_name, $request->usuario->password, $data_cadastro);                    $perfil->insertRow('perfil', $cmp, $vlr);                    echo 'cadastrado com sucesso';                } else {                    echo "invalido";                }            break;        case 'config':                if (isset($request->email)) {                    $data = array(                        "nome = '{$request->usuario->first_name}'",                        "sobrenome = '{$request->usuario->last_name}'",                        "email = '{$request->usuario->email}'",                        "dt_nascimento = '{$request->usuario->dt_nascimento}'",                        "sexo = '{$request->usuario->sexo}'",                    );                    $perfil->updateRow('perfil', $data, "id_perfil = {$request->usuario->id_perfil}");                    echo 'atualizado com sucesso';                } else {                    echo "invalido";                }            break;    }} catch (Exception $e) {    echo false;}?>